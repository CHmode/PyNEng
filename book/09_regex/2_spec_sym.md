## Специальные символы

Полностью возможности регулярных выражений проявляются при использовании специальных символов.

Специальные символы:
* ```.``` - любой символ, кроме символа новой строки (опция m позволяет включить и символ новой строки)
* ```^``` - начало строки
* ```$``` - конец строки
* ```[abc]``` - любой символ в скобках
* ```[^abc]``` - любой символ, кроме тех, что в скобках
* ```a|b``` - элемент a или b
* ```(regex)``` - выражение рассматривается как один элемент. Текст, который совпал с выражением, запоминается

Повторение:
* ```regex*``` - ноль или более повторений предшествующего элемента
* ```regex+``` - одно или более повторений предшествующего элемента
* ```regex?``` - ноль или одно повторение предшествующего элемента
* ```regex{n}``` - ровно n повторений предшествующего элемента
* ```regex{n,m}``` - от n до m повторений предшествующего элемента
* ```regex{n, }``` - n или более повторений предшествующего элемента

Предопределенные наборы символов:
* ```\d``` - любая цифра
* ```\D``` - любое нечисловое значение
* ```\s``` - whitespace (\t\n\r\f\v)
* ```\S``` - все, кроме whitespace
* ```\w``` - любая буква или цифра
* ```\W``` - все, кроме букв и цифр



> В большинстве примеров используется функция findall, так как она ищет все совпадения в строке и возвращает список найденных совпадений.


### ```.```

Точка обозначает любой символ.
Выражение ```.0``` означает любой символ, а затем 0.
В строке line найдено 2 совпадения с регулярным выражением:
```python
In [1]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [2]: re.findall('.0', line)
Out[2]: ['10', 't0']
```

Выражение ```... ``` означает три любых символа и пробел.
В строке line нашлось три совпадения:
```py
In [3]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [4]: re.findall('... ', line)
Out[4]: ['100 ', '    ', '5d3 ']

```

### ```^```

Символ ```^``` означает начало строки. Выражению ```^10``` соотвествует только одна подстрока:
```python
In [5]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [6]: re.findall('^10', line)
Out[6]: ['10']
```

Первые три символа с начала строки
```py
In [7]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [8]: re.findall('^...', line)
Out[8]: ['100']

```

### ```$```

Символ ```$``` обозначает конец строки:
```python
In [9]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"


In [10]: re.findall('...$', line)
Out[10]: ['0/1']
```

### ```[]```

Символы, которые перечислены в квадратных скобках, означают, что любой из этих символов будет совпадением.
Таким образом можно описывать разные регистры:
```python
In [11]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [12]: print(re.findall('[Ff]ast', line))
['Fast']

In [13]:  print(re.findall('[Ff]ast[Ee]thernet', line))
['FastEthernet']

```

В квадратных скобках можно указывать диапазоны символов.
Например, таким образом можно указать, что нас интересует любая цифра от 0 до 9:
```py
In [14]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [15]: print(re.findall('[0-9]', line))
['1', '0', '0', '1', '2', '3', '5', '5', '3', '0', '1']

```

Аналогичным образом можно указать буквы:
```py
In [16]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [17]: print(re.findall('[a-z]', line))
['a', 'a', 'f', 'e', 'a', 'd', 'a', 's', 't', 't', 'h', 'e', 'r', 'n', 'e', 't']

In [18]: print(re.findall('[A-Z]', line))
['F', 'E']
```

В квадратных скобках можно указывать несколько диапазонов:
```py
In [19]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [20]: print(re.findall('[A-Za-z0-9]', line))
['1', '0', '0', 'a', 'a', '1', '2', '3', '5', 'f', 'e', 'a', '5', 'd', '3', 'F', 'a', 's', 't', 'E', 't', 'h', 'e', 'r', 'n', 'e', 't', '0', '1']

```

Выражение ```[abc][0-9]``` означает два символа: первый - a, b или c, а второй - число от 0 до 9:
```py
In [21]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [22]: print(re.findall('[abc][0-9]', line))
['a1', 'a5']
```

Еще одна особенность квадратных скобок - специальные символы внутри квадратных скобок теряют свое специальное значение и обозначают просто символ.
Например, точка внутри квадратных скобок будет обозначать точку, а не любой символ.

Выражение ```[a-f0-9][./][a-f0-9]``` описывает три символа:
1. буква a, b, c, d, e или f или цифра от 0 до 9
2. точка или слеш
3. буква a, b, c, d, e или f или цифра от 0 до 9

Для строки line совпадением будут найдены такие совпадения:
```py
In [23]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [24]: print(re.findall('[a-f0-9][./][a-f0-9]', line))
['2.3', 'e.a', '0/1']

```


Если после открывающейся квадратной скобки, указан символ ```^```, совпадением будет любой символ, кроме указанных в скобках (в данном случае, всё, кроме букв и пробела):
```python
In [25]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [26]: print(re.findall('[^a-zA-Z ]', line))
['1', '0', '0', '1', '2', '.', '3', '5', '.', '5', '3', '0', '/', '1']

```

### ```|```

Вертикальная черта работает как 'или':
```python
In [27]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [28]: print(re.findall('100|Fast|0/1', line))
['100', 'Fast', '0/1']

```

Обратите внимание на то, как срабатывает ```|``` - 100, Fast и 0/1 воспринимаются как целое выражение.
То есть, в итоге выражение означает, что мы ищем 100, Fast или 0/1, а не то, что мы ищем 10, затем 0 или F, as, затем t или 0 и 0/1.


Таким образом мы получаем все совпадения, где встретились два числа или две буквы:
```python
In [29]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [30]: print(re.findall('[0-9][0-9]|[a-z][a-z]', line))
['10', 'aa', '12', '35', 'fe', 'as', 'th', 'er', 'ne']
```

### ```()```

Скобки используются для группировки выражений.
Как и в математических выражениях, с помощью скобок можно указать к каким элементам применяется операция.

Например, выражение ```[0-9]([a-f]|[0-9])[0-9]``` описывает три символа: цифра, потом буква или цифра и цифра.

Функция findall, при наличии скобок в выражении, перестает возвращать все совпадение, а возвращает только то, что совпало с выражением в скобках:
```py
In [31]: line = "100     aa12.35fe.a5d3    FastEthernet0/1"

In [32]: print(re.findall('[0-9]([a-f]|[0-9])[0-9]', line))
['0', 'd']
```

Если, вместо findall, использовать finditer, получится такой результат:
```py
In [33]: print([i.group() for i in re.finditer('[0-9]([a-f]|[0-9])[0-9]', line)])
['100', '5d3']
```

> В следующих примерах используется функция search - она ищет только одно совпадение, а не все, как findall и finditer.

Скобки позволяют указывать какое выражение является одним целым.
Особенно важно это при использовании символов повторения.
Они будут рассматриваться позже, но пока что небольшой пример:
```py
In [34]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [35]: re.search('a1+', line).group()
Out[35]: 'a1'
```

Тут выражение описывает, что должна идти буква a, а затем 1, как минимум, один раз.

Если же взять в скобки a1, это будет означать, что подстрока 'a1' должна встретиться один или более раз:
```py
In [36]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [37]: re.search('(a1)+', line).group()
Out[37]: 'a1a1'
```

Тут скобки использовались, чтобы указать, что повторяться должна подстрока a1, а не только единица.


Скобки позволяют не только группировать выражения.
Кроме того, строка, которые совпала с выражением в скобках, запоминается.
Ее можно получить отдельно с помощью специальных методов groups и group(n).
Это рассматривается в отдельном разделе "Группировка выражений".


### Символы повторения

### ```*```

Звездочка указывает, что предыдущее выражение может повторяться 0 или более раз.

Например, если звездочка стоит после символа, она означает повторение этого символа.

Выражение ```ba*``` означает b, а затем ноль или более повтрений a:
```py
In [38]: line = '100     a011.baaa.a5d3    FastEthernet0/1'

In [39]: re.search('ba*', line).group()
Out[39]: 'baaa'
```

Если в строке line до подстроки baaa встретится b, то совпадением будет b:
```py
In [40]: line = '100     ab11.baaa.a5d3    FastEthernet0/1'

In [41]: re.search('ba*', line).group()
Out[41]: 'b'

```

В этом примере, выражение описывает одну или более цифр и выведены два примера: с использованием метода search, чтобы найти только первое совпадение и с использованием findall, чтобы получить все совпадения:
```py
In [42]: line = '100     ab11.baaa.a5d3    FastEthernet0/1'

In [43]: re.search('[0-9][0-9]*', line).group()
Out[43]: '100'

In [44]: re.findall('[0-9][0-9]*', line)
Out[44]: ['100', '11', '5', '3', '0', '1']

```


### ```+```

Плюс указывает, что предыдущее выражение может повторяться сколько угодно раз, но, как минимум, один раз.

В таком виде, повторение относится к букве a:
```py
In [45]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [46]: re.search('a+', line).group()
Out[46]: 'aa'
```

А в этом выражении, повторяется строка 'a1'
```py
In [47]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [48]: re.search('(a1)+', line).group()
Out[48]: 'a1a1'

```


Выражение ```[0-9]+ +[a-f0-9.]+``` описывает строку, в которой сначала идут цифры, затем пробелы, а потом буквы a-f, цифры или точка:
```py
In [49]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [50]: re.search('[0-9]+ +[a-f0-9.]+', line).group()
Out[50]: '100     aab1.a1a1.a5d3'

```

### ```{n}```

С помощью фигурных скобок можно указать сколько должно повторяться предшествующее выражение.

Например, изменим предыдущее выражение, и укажем, что должно быть ровно три цифры:
```py

In [51]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [52]: re.search('[0-9]{3} +[a-f0-9.]+', line).group()
Out[52]: '100     aab1.a1a1.a5d3'

```

Число три в фигурных скобках означает, что предыдущее выражение должно повторяться 3 раза. В данном случае, это значит, что должны идти подряд три цифры.

Если изменить строку line и указать номер VLAN 1500, совпадением будет 500:
```py
In [53]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [54]: re.search('[0-9]{3} +[a-f0-9.]+', line).group()
Out[54]: '500     aab1.a1a1.a5d3'

```

Тут пригодится еще одна форма повторения.
В фигурных скобках можно указать два числа через запятую.

Например, выражение ```[0-9]{1,4}``` означает, что должны идти от одной до четырех цифр:
```py
In [55]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [56]: re.search('[0-9]{1,4} +[a-f0-9.]+', line).group()
Out[56]: '1500     aab1.a1a1.a5d3'

```

### Наборы символов

Кроме перечисленных специальных символов, в Python есть специальные обозначения для ноборов символов:

* ```\d``` - любая цифра
* ```\D``` - любое нечисловое значение
* ```\s``` - whitespace (\t\n\r\f\v)
* ```\S``` - все, кроме whitespace
* ```\w``` - любая буква или цифра
* ```\W``` - все, кроме букв и цифр

> Это не все наборы символов, которые поддерживает Python. Подробнее смотрите в [документации](https://docs.python.org/3/library/re.html).

Наборы символов позволяют писать более короткие выражения, без необходимости перечислять символы в квадратных скобках.

Например, выражение ```\d+\s+\S+``` описывает строку, в которой идут цифры, пробел (whitespace), не whitespace символы, то есть все кроме пробела, таба и других whitespace сиволов:
```py
In [57]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [58]: re.search('\d+\s+\S+', line).group()
Out[58]: '1500     aab1.a1a1.a5d3'

```

