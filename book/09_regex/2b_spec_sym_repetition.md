## Символы повторения


* ```regex+``` - одно или более повторений предшествующего элемента
* ```regex*``` - ноль или более повторений предшествующего элемента
* ```regex?``` - ноль или одно повторение предшествующего элемента
* ```regex{n}``` - ровно n повторений предшествующего элемента
* ```regex{n,m}``` - от n до m повторений предшествующего элемента
* ```regex{n, }``` - n или более повторений предшествующего элемента



### ```+```

Плюс указывает, что предыдущее выражение может повторяться сколько угодно раз, но, как минимум, один раз.

Например, тут повторение относится к букве a:
```py
In [45]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [46]: re.search('a+', line).group()
Out[46]: 'aa'
```

А в этом выражении, повторяется строка 'a1':
```py
In [47]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [48]: re.search('(a1)+', line).group()
Out[48]: 'a1a1'

```

> В выражении ```(a1)+```, скобки используются для того чтобы указать, что повторение относится к последовательности символов 'a1'.

IP-адрес можно описать выражением ```\d+\.\d+\.\d+\.\d+```.
Тут плюс используется чтобы указать, что цифр может быть несколько.
А также встречается выражение ```\.```.

Оно необходимо из-за того, что точка является специальным символом (она обозначает любой символ).
И чтобы указать, что нас интересует именно точка, надо ее экранировать - поместить перед точкой обратный слеш.

Используя это выражение можно получить IP-адрес из строки sh_ip_int_br:
```python
In [45]: sh_ip_int_br = 'Ethernet0/1    192.168.200.1   YES NVRAM  up          up'

In [46]: re.search('\d+\.\d+\.\d+\.\d+', sh_ip_int_br).group()
Out[46]: '192.168.200.1'
```

Еще один пример выражения: ```\d+\s+\S+``` - оно описывает строку, в которой идут цифры, пробел (whitespace), не whitespace символы, то есть все кроме пробела, таба и других whitespace символов.
С его помощью можно получить VLAN и MAC-адрес из строки:
```py
In [57]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [58]: re.search('\d+\s+\S+', line).group()
Out[58]: '1500     aab1.a1a1.a5d3'

```


### ```*```

Звездочка указывает, что предыдущее выражение может повторяться 0 или более раз.

Например, если звездочка стоит после символа, она означает повторение этого символа.

Выражение ```ba*``` означает b, а затем ноль или более повтрений a:
```py
In [38]: line = '100     a011.baaa.a5d3    FastEthernet0/1'

In [39]: re.search('ba*', line).group()
Out[39]: 'baaa'
```

Если в строке line до подстроки baaa встретится b, то совпадением будет b:
```py
In [40]: line = '100     ab11.baaa.a5d3    FastEthernet0/1'

In [41]: re.search('ba*', line).group()
Out[41]: 'b'

```

Допустим, необходимо написать регулярное выражение, которое описывает email'ы двух форматов: user@example.com и user.test@example.com.
То есть в левой части адреса может быть или одно слово или два слова разделенные точкой.

Первый вариант на примере адреса без точки:
```python
In [127]: email1 = 'user1@gmail.com'
```

Этот адрес можно описать таким выражением ```\w+@\w+\.\w+```:
```python
In [128]: re.search('\w+@\w+\.\w+', email1).group()
Out[128]: 'user1@gmail.com'
```

Но такое выражение не подходит email с точкой:
```python
In [130]: email2 = 'user2.test@gmail.com'

In [131]: re.search('\w+@\w+\.\w+', email2).group()
Out[131]: 'test@gmail.com'
```

Регулярное выражение для адреса с точкой:
```python
In [133]: re.search('\w+\.\w+@\w+\.\w+', email2).group()
Out[133]: 'user2.test@gmail.com'
```

Чтобы описать оба варианта адресов, надо указать, что точка в адресе опциональна:
```
'\w+\.*\w+@\w+\.\w+'
```

Такое регулярное выражение описывает оба варианта:
```python
In [136]: email1 = 'user1@gmail.com'

In [137]: email2 = 'user2.test@gmail.com'

In [138]: re.search('\w+\.*\w+@\w+\.\w+', email1).group()
Out[138]: 'user1@gmail.com'

In [139]: re.search('\w+\.*\w+@\w+\.\w+', email2).group()
Out[139]: 'user2.test@gmail.com'
```

### ```?```

В последнем примере регулярное выражение указывает, что точка опциональна.
Но, в то же время, указывает и то, что точка может появиться много раз.

В этой ситуации, логичней использовать знак вопроса.
Он обозначает ноль или одно повторение предыдущего выражения или символа.
Теперь регулярное выражение выглядит так ```\w+\.?\w+@\w+\.\w+```:
```python
In [163]: mail_log = ['Jun 18 14:10:35 client-ip=154.10.180.10 from=user1@gmail.com, size=551',
     ...:             'Jun 18 14:11:05 client-ip=150.10.180.10 from=user2.test@gmail.com, size=768']

In [164]: for message in mail_log:
     ...:     match = re.search('\w+\.?\w+@\w+\.\w+', message)
     ...:     if match:
     ...:         print("Found email: ", match.group())
     ...:
Found email:  user1@gmail.com
Found email:  user2.test@gmail.com
```

### ```{n}```

С помощью фигурных скобок можно указать сколько должно повторяться предшествующее выражение.

Например, изменим предыдущее выражение, и укажем, что должно быть ровно три цифры:
```py

In [51]: line = '100     aab1.a1a1.a5d3    FastEthernet0/1'

In [52]: re.search('[0-9]{3} +[a-f0-9.]+', line).group()
Out[52]: '100     aab1.a1a1.a5d3'

```

Число три в фигурных скобках означает, что предыдущее выражение должно повторяться 3 раза. В данном случае, это значит, что должны идти подряд три цифры.

Если изменить строку line и указать номер VLAN 1500, совпадением будет 500:
```py
In [53]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [54]: re.search('[0-9]{3} +[a-f0-9.]+', line).group()
Out[54]: '500     aab1.a1a1.a5d3'

```

Тут пригодится еще одна форма повторения.
В фигурных скобках можно указать два числа через запятую.

Например, выражение ```[0-9]{1,4}``` означает, что должны идти от одной до четырех цифр:
```py
In [55]: line = '1500     aab1.a1a1.a5d3    FastEthernet0/1'

In [56]: re.search('[0-9]{1,4} +[a-f0-9.]+', line).group()
Out[56]: '1500     aab1.a1a1.a5d3'

```

